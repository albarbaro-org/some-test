# 1. System Definition
# Purpose: Groups all related components, resources, and APIs.
---
apiVersion: backstage.io/v1alpha1
kind: System
metadata:
  name: payment-processing-system
  description: Core services and infrastructure responsible for payment lifecycle.
spec:
  owner: group:default/perf-group-1
  domain: commerce
---
# 2. Main Component Definition (Payment Gateway Service)
# This covers: owner, system, dependsOn, providesApis, consumesApis, hasPart
apiVersion: backstage.io/v1alpha1
kind: Component
metadata:
  name: payment-gateway-service
  description: Microservice that handles authorization and capture of customer payments.
  annotations:
    # Example annotation for an external tool link
    jira/project-key: PGW
spec:
  type: service
  lifecycle: production
  owner: group:default/perf-group-1
  system: payment-processing-system
  # RELATIONSHIP: hasPart
  # The component is composed of these sub-components (e.g., a worker and a web process)
  hasPart:
    - component:payment-gateway-worker
  # RELATIONSHIP: dependsOn
  # The component relies on external resources and APIs
  dependsOn:
    - resource:payment-processing-db
    - api:external-card-processor-api
  # RELATIONSHIP: providesApis
  # The component exposes these APIs for other services to use
  providesApis:
    - payment-v1-api
    - payment-status-v1-api
  # RELATIONSHIP: consumesApis
  # The component uses this API from another internal service (e.g., a config service)
  consumesApis:
    - internal-config-api
---
# 3. Sub-Component Definition (Worker)
# This covers: partOf
apiVersion: backstage.io/v1alpha1
kind: Component
metadata:
  name: payment-gateway-worker
  description: Asynchronous worker for processing post-authorization payment events.
spec:
  type: service
  lifecycle: production
  owner: group:default/perf-group-1
  # RELATIONSHIP: partOf
  # The component is a part of the main gateway service
  partOf: payment-gateway-service
  system: payment-processing-system
---
# 4. Resource Definition (Database)
# This covers: dependsOn (reverse relationship)
apiVersion: backstage.io/v1alpha1
kind: Resource
metadata:
  name: payment-processing-db
  description: Primary database (PostgreSQL) for payment transaction records.
spec:
  type: database
  lifecycle: production
  owner: group:default/perf-group-1
  system: payment-processing-system
---
# 5. API Definition (Internal API Provided by the Component)
# This covers: apiConsumedBy (reverse relationship), apiProvidedBy
apiVersion: backstage.io/v1alpha1
kind: API
metadata:
  name: payment-v1-api
  description: API for authorizing and capturing new payments.
spec:
  type: openapi
  lifecycle: production
  owner: group:default/perf-group-1
  system: payment-processing-system
  # RELATIONSHIP: apiProvidedBy
  # This API is implemented by the payment-gateway-service
  apiProvidedBy: component:payment-gateway-service
---
# 6. API Definition (Internal API Consumed by the Component)
# This covers: apiConsumedBy
apiVersion: backstage.io/v1alpha1
kind: API
metadata:
  name: internal-config-api
  description: Internal service API for fetching feature flags and configuration settings.
spec:
  type: openapi
  lifecycle: production
  owner: group:default/platform-infra
  system: platform-config-system
  # RELATIONSHIP: apiConsumedBy
  # This API is consumed by the payment-gateway-service
  apiConsumedBy:
    - component:payment-gateway-service
