# ==========================================
# 1. DOMAIN DEFINITION
# ==========================================
apiVersion: backstage.io/v1alpha1
kind: Domain
metadata:
  name: commerce
  description: The business domain for all commerce and payment capabilities.
spec:
  owner: group:default/perf-group-1

---
# ==========================================
# 2. SYSTEM DEFINITIONS
# ==========================================
# System A: The main payment system
apiVersion: backstage.io/v1alpha1
kind: System
metadata:
  name: payment-processing-system
  description: Core services and infrastructure responsible for payment lifecycle.
spec:
  owner: group:default/perf-group-1
  domain: commerce

---
# System B: The platform config system (Referenced by the internal-config-api)
apiVersion: backstage.io/v1alpha1
kind: System
metadata:
  name: platform-config-system
  description: System responsible for dynamic configuration and feature flagging.
spec:
  owner: group:default/perf-group-1
  domain: commerce

---
# ==========================================
# 3. COMPONENT DEFINITIONS
# ==========================================
# Component A: The main Gateway Service
apiVersion: backstage.io/v1alpha1
kind: Component
metadata:
  name: payment-gateway-service
  description: Microservice that handles authorization and capture of customer payments.
  annotations:
    jira/project-key: PGW
spec:
  type: service
  lifecycle: production
  owner: group:default/perf-group-1
  system: payment-processing-system
  # Sub-components
  hasPart:
    - component:payment-gateway-worker
  # Dependencies (Resources and APIs)
  dependsOn:
    - resource:payment-processing-db
    - api:external-card-processor-api
  # APIs provided by this service
  providesApis:
    - payment-v1-api
    - payment-status-v1-api
  # APIs consumed by this service
  consumesApis:
    - internal-config-api

---
# Component B: The Worker Sub-component
apiVersion: backstage.io/v1alpha1
kind: Component
metadata:
  name: payment-gateway-worker
  description: Asynchronous worker for processing post-authorization payment events.
spec:
  type: service
  lifecycle: production
  owner: group:default/perf-group-1
  partOf: payment-gateway-service
  system: payment-processing-system

---
# ==========================================
# 4. RESOURCE DEFINITION
# ==========================================
apiVersion: backstage.io/v1alpha1
kind: Resource
metadata:
  name: payment-processing-db
  description: Primary database (PostgreSQL) for payment transaction records.
spec:
  type: database
  lifecycle: production
  owner: group:default/perf-group-1
  system: payment-processing-system

---
# ==========================================
# 5. API DEFINITIONS
# ==========================================
# API 1: Payment V1 (Provided by Gateway)
apiVersion: backstage.io/v1alpha1
kind: API
metadata:
  name: payment-v1-api
  description: API for authorizing and capturing new payments.
spec:
  type: openapi
  lifecycle: production
  owner: group:default/perf-group-1
  system: payment-processing-system
  apiProvidedBy: component:payment-gateway-service
  definition:
    $text: https://github.com/APIs-guru/openapi-directory/blob/main/APIs/archive.org/wayback/1.0.0/openapi.yaml

---
# API 2: Payment Status V1 (Provided by Gateway) - WAS MISSING
apiVersion: backstage.io/v1alpha1
kind: API
metadata:
  name: payment-status-v1-api
  description: API for checking the status of existing transactions.
spec:
  type: openapi
  lifecycle: production
  owner: group:default/perf-group-1
  system: payment-processing-system
  apiProvidedBy: component:payment-gateway-service
  definition:
    $text: https://github.com/APIs-guru/openapi-directory/blob/main/APIs/archive.org/wayback/1.0.0/openapi.yaml

---
# API 3: External Card Processor (Dependency) - WAS MISSING
apiVersion: backstage.io/v1alpha1
kind: API
metadata:
  name: external-card-processor-api
  description: External 3rd party API for credit card validation.
spec:
  type: openapi
  lifecycle: production
  owner: group:default/perf-group-1
  system: payment-processing-system
  # Note: No 'apiProvidedBy' because it is external to this catalog
  definition:
    $text: https://github.com/APIs-guru/openapi-directory/blob/main/APIs/archive.org/wayback/1.0.0/openapi.yaml

---
# API 4: Internal Config API (Consumed by Gateway)
apiVersion: backstage.io/v1alpha1
kind: API
metadata:
  name: internal-config-api
  description: Internal service API for fetching feature flags and configuration settings.
spec:
  type: openapi
  lifecycle: production
  owner: group:default/perf-group-1
  system: platform-config-system
  apiConsumedBy:
    - component:payment-gateway-service
  definition:
    $text: https://github.com/APIs-guru/openapi-directory/blob/main/APIs/archive.org/wayback/1.0.0/openapi.yaml
